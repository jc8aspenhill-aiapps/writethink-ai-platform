# WriteThink AI Platform - Project Rules

## Project Overview
- **Platform**: AI-powered writing coach helping students develop stronger arguments through guided thinking
- **Design Attribution**: Designed by Lemiscatemind.com (must be included in all branding)
- **Core Philosophy**: Guide student thinking rather than providing answers or writing content for them

## Tech Stack & Architecture
- **Frontend**: Next.js 16 with TypeScript, Tailwind CSS, Lucide React icons
- **Backend**: Cloudflare Functions (not Next.js API routes)
- **AI Integration**: Claude 3 Haiku via Anthropic API
- **Export**: Word documents (.docx) using docx and file-saver packages
- **Deployment**: Cloudflare Pages with static export configuration

## Deployment Configuration
- **Framework**: Next.js (Static HTML Export) 
- **Build Command**: `npx next build`
- **Output Directory**: `out`
- **Next.js Config**: Must include `output: 'export'`, `trailingSlash: true`, `images: { unoptimized: true }`
- **API Routes**: Use Cloudflare Functions in `/functions/api/` directory, NOT Next.js API routes
- **Environment Variables**: `CLAUDE_API_KEY` must be set in Cloudflare Pages dashboard

## Cloudflare Functions Pattern
- **Location**: `/functions/api/claude.js`
- **Exports**: `onRequestPost` for main functionality, `onRequestOptions` for CORS
- **Headers**: Always include CORS headers (`Access-Control-Allow-Origin: '*'`)
- **API Key**: Access via `env.CLAUDE_API_KEY` parameter
- **Error Handling**: Return proper HTTP status codes with JSON error messages

## UI/UX Patterns
- **Branding**: "WriteThink AI" title with "Designed by Lemiscatemind.com" attribution in header and footer
- **Phases**: Input → Develop → Structure → Refine → Voice (with progress indicators)
- **Export Availability**: Show export buttons only when content exists (`Object.keys(studentNotes).length > 0`)
- **Error States**: Show user-friendly error messages for API failures, not technical details

## Word Document Export Requirements
- **Full Context**: Include complete original questions/prompts, not just user responses
- **Structure**: Topic → Clarifying Questions → Thinking Prompts → Additional Notes → Chat History
- **Attribution**: Include "Generated by WriteThink AI Platform" and "Designed by Lemiscatemind.com" in footer
- **Formatting**: Use proper headings, bold/italic text, indentation for responses
- **File Naming**: `WriteThink_AI_{topic}_{date}.docx` format

## Development Workflow
- **Local Testing**: Use `./start.sh` script with `.env.local` for API key
- **Git Strategy**: Commit frequently, push to GitHub triggers auto-deployment
- **Build Testing**: Always run `npm run build` locally before deployment
- **Error Handling**: Fix TypeScript errors completely before deployment (blank pages indicate build failures)

## API Integration Patterns
- **Claude API Model**: Always use `claude-3-haiku-20240307`
- **Token Limits**: Default 1000, max 2000 for development, 500 for chat
- **Error Handling**: Handle 401 (invalid key), 429 (rate limit), 400 (bad request) specifically
- **Response Format**: Extract `content[0].text` from Claude API response
- **JSON Parsing**: Parse Claude responses as JSON for structured development data

## Security & Environment
- **API Key Storage**: Never expose in frontend code, use environment variables only
- **CORS**: Enable for cross-origin requests in Cloudflare Functions
- **GitHub Auth**: Use Personal Access Tokens, not passwords for git operations
- **Build Logs**: Always check Cloudflare Pages deployment logs for errors

## Common Troubleshooting
- **Blank Page**: Usually indicates build failure or wrong output directory
- **API Errors**: Check environment variable spelling and Cloudflare Functions syntax
- **Build Failures**: Often TypeScript errors or missing dependencies
- **Git Issues**: Ensure in correct directory with `.git` folder present
- **Static Export**: Required for Cloudflare Pages, cannot use server-side Next.js features

## File Structure Requirements
```
/functions/api/claude.js     # Cloudflare Function for Claude API
/src/components/             # React components
/src/utils/exportUtils.ts    # Word document export logic
next.config.ts              # Static export configuration
.env.local                  # Local API key (never commit)
```